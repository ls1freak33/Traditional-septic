<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Construction Estimator</title>

<style>
  :root{
    --bg:#000;
    --panel:#0b0b0b;
    --panel2:#050505;
    --yellow:#facc15;
    --white:#fff;
    --company:#38bdf8;
    --green:#22c55e;
    --blue:#2563eb;
    --danger:#dc2626;
    --muted:#bdbdbd;
  }

  *{ box-sizing:border-box; }

  body{
    margin:0;
    background:var(--bg);
    color:var(--white);
    font-family:Arial, sans-serif;
  }

  /* Top nav */
  .nav{
    display:flex;
    gap:10px;
    padding:10px;
    justify-content:center;
    flex-wrap:wrap;
    border-bottom:2px solid var(--yellow);
    background:#000;
    position:sticky;
    top:0;
    z-index:10;
  }
  .nav button{
    background:var(--yellow);
    color:#000;
    border:none;
    padding:12px 16px;
    border-radius:10px;
    font-weight:800;
    cursor:pointer;
    min-width:120px;
  }

  .container{
    max-width:760px;
    margin:0 auto;
    padding:14px;
  }

  .card{
    border:2px solid var(--yellow);
    border-radius:14px;
    background:var(--panel2);
    padding:14px;
  }

  h1{
    text-align:center;
    color:var(--yellow);
    font-size:34px;
    margin:8px 0 6px;
    letter-spacing:0.5px;
  }

  .company{
    text-align:center;
    color:var(--company);
    font-weight:800;
    font-size:18px;
    margin-bottom:14px;
  }

  .section{
    border:1px solid var(--yellow);
    border-radius:12px;
    padding:12px;
    margin:12px 0;
    background:var(--panel);
  }
  .section-title{
    color:var(--yellow);
    font-weight:900;
    font-size:18px;
    margin-bottom:10px;
  }

  .grid2{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }
  @media (max-width:640px){
    .grid2{ grid-template-columns:1fr; }
    h1{ font-size:30px; }
    .nav button{ flex:1 1 45%; }
  }

  label{
    display:block;
    font-size:13px;
    color:var(--muted);
    margin:2px 0 6px;
    font-weight:700;
  }

  input, select{
    width:100%;
    padding:11px;
    margin-bottom:10px;
    background:#000;
    border:1px solid var(--yellow);
    border-radius:10px;
    color:var(--white);
    font-size:16px;
    outline:none;
  }

  .btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:12px;
    font-weight:900;
    font-size:16px;
    cursor:pointer;
    margin-top:10px;
  }
  .btn-yellow{ background:var(--yellow); color:#000; }
  .btn-green{ background:var(--green); color:#000; }
  .btn-blue{ background:var(--blue); color:#fff; }
  .btn-danger{ background:var(--danger); color:#fff; }

  .total{
    text-align:center;
    font-size:30px;
    font-weight:1000;
    color:var(--yellow);
    margin-top:12px;
  }

  .subnote{
    font-size:12px;
    color:var(--muted);
    margin-top:-6px;
    margin-bottom:10px;
  }

  .page{ display:none; }
  .page.active{ display:block; }

  .pill{
    display:inline-block;
    padding:6px 10px;
    border:1px solid var(--yellow);
    border-radius:999px;
    color:var(--yellow);
    font-weight:900;
    font-size:12px;
  }

  .jobList{ display:flex; flex-direction:column; gap:10px; }
  .jobItem{
    border:1px solid #444;
    border-radius:12px;
    padding:10px;
    background:#070707;
  }
  .jobItem b{ color:var(--yellow); }
  .jobItem .row{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:8px;
  }
  .jobItem .row button{
    flex:1 1 120px;
    padding:10px;
    border-radius:10px;
    border:none;
    font-weight:900;
    cursor:pointer;
  }

  /* MODAL */
  .modal{
    display:none;
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.75);
    z-index:999;
    padding:14px;
    overflow:auto;
  }
  .modal.open{ display:block; }
  .modalCard{
    max-width:900px;
    margin:0 auto;
    background:#fff;
    color:#111;
    border-radius:14px;
    padding:18px;
  }
  .modalTop{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    justify-content:space-between;
    align-items:center;
    margin-bottom:12px;
  }
  .modalTop h2{ margin:0; font-size:18px; }
  .modalBtns{ display:flex; gap:10px; flex-wrap:wrap; }
  .modalBtns button{
    border:none;
    border-radius:10px;
    padding:10px 14px;
    font-weight:900;
    cursor:pointer;
  }
  .modalBtns .copy{ background:var(--blue); color:#fff; }
  .modalBtns .print{ background:var(--green); }
  .modalBtns .close{ background:#ddd; }

  /* Quote styling */
  .qTitle{ text-align:center; margin:0; }
  .qMuted{ text-align:center; color:#555; margin-top:4px; }
  .qBox{ border:1px solid #ddd; padding:12px; border-radius:10px; margin-top:12px; }
  .qTable{ width:100%; border-collapse:collapse; margin-top:10px; }
  .qTable th, .qTable td{ border:1px solid #ddd; padding:10px; text-align:left; }
  .qRight{ text-align:right; }
  .qTotal{ font-size:20px; font-weight:900; }
  .sigline{ border-top:1px solid #111; width:280px; margin-top:40px; }

  /* Verbal styling */
  .vCard{
    border:1px solid #ddd;
    border-radius:12px;
    padding:14px;
    margin-top:12px;
  }
  .vBig{
    font-size:30px;
    font-weight:1000;
    text-align:center;
    margin:0;
  }
  .vLine{
    text-align:center;
    color:#333;
    font-weight:800;
    margin:6px 0 0;
  }
  .vSmall{
    margin-top:10px;
    color:#333;
    line-height:1.35;
  }
  .vSmall b{ color:#000; }

  /* Preset buttons row */
  .presetRow{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    margin-bottom:10px;
  }
  .presetRow button{
    flex:1 1 140px;
    border:none;
    border-radius:10px;
    padding:10px 12px;
    font-weight:900;
    cursor:pointer;
    background:var(--blue);
    color:#fff;
  }

  /* PRINT ONLY MODAL CONTENT */
  @media print{
    body{ background:#fff; }
    .nav, .container{ display:none !important; }
    .modal{
      display:block !important;
      position:static !important;
      inset:auto !important;
      background:#fff !important;
      padding:0 !important;
    }
    .modalTop{ display:none !important; }
    .modalCard{
      box-shadow:none !important;
      border-radius:0 !important;
      max-width:none !important;
      padding:0 !important;
    }
  }
</style>
</head>

<body>

<div class="nav">
  <button onclick="goHome()">Home</button>
  <button onclick="openSeptic('conventional')">Conventional Septic</button>
  <button onclick="openSeptic('chamber')">Chamber Septic</button>
  <button onclick="openPad()">Pad Work</button>
  <button onclick="openClear()">Land Clearing</button>
</div>

<div class="container">
  <div class="card">

    <!-- HOME -->
    <div id="page_home" class="page active">
      <h1>Construction Estimator</h1>
      <div class="company">Crest View Construction LLC</div>

      <div class="section">
        <div class="section-title">Start</div>
        <p style="margin:0; line-height:1.4;">
          Use the buttons at the top to switch between estimators.
          Save jobs offline so you can pull them up later even with no service.
        </p>
      </div>

      <div class="section">
        <div class="section-title">Saved Jobs</div>
        <button class="btn btn-blue" onclick="openJobs()">View / Load Saved Jobs</button>
      </div>
    </div>

    <!-- JOBS -->
    <div id="page_jobs" class="page">
      <h1>Saved Jobs</h1>
      <div class="company">Crest View Construction LLC</div>

      <div class="section">
        <div class="section-title">Jobs Stored Offline</div>
        <div class="subnote">Stored in this phone/browser (localStorage).</div>
        <div id="jobsList" class="jobList"></div>
        <button class="btn btn-yellow" onclick="goHome()">Back</button>
      </div>
    </div>

    <!-- SEPTIC -->
    <div id="page_septic" class="page">
      <h1 id="septicTitle">Septic Estimator</h1>
      <div class="company">Crest View Construction LLC</div>
      <div style="text-align:center; margin-bottom:10px;">
        <span class="pill" id="septicModePill">MODE</span>
      </div>

      <div class="section">
        <div class="section-title">Job Info</div>
        <div class="grid2">
          <div>
            <label>Customer Name</label>
            <input id="s_customer" placeholder="Customer Name" />
          </div>
          <div>
            <label>Job #</label>
            <input id="s_job" placeholder="Job #" />
          </div>
        </div>
        <label>Job Location</label>
        <input id="s_location" placeholder="Job Location" />
      </div>

      <div class="section">
        <div class="section-title">System Details</div>
        <div class="grid2">
          <div>
            <label>Tank Cost ($)</label>
            <input id="s_tank" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Field Line Length (ft)</label>
            <input id="s_fieldFt" type="number" inputmode="decimal" placeholder="0" />
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>Pipe $ / ft</label>
            <input id="s_pipePerFt" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Markup %</label>
            <input id="s_markup" type="number" inputmode="decimal" placeholder="20" value="20" />
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Rock (Hauled In)</div>
        <div class="subnote">Rock is priced by tons (default $17/ton). Chamber mode removes rock automatically.</div>
        <div class="grid2">
          <div>
            <label>Rock Tons</label>
            <input id="s_rockTons" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Cost per Ton ($)</label>
            <input id="s_rockPerTon" type="number" inputmode="decimal" value="17" />
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Hauling</div>
        <div class="subnote">Haul cost is in cents per mile (ex: 35 = $0.35/mi). Distance is one-way.</div>
        <div class="grid2">
          <div>
            <label>Haul Distance (miles one way)</label>
            <input id="s_haulMiles" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Haul Cost (cents per mile)</label>
            <input id="s_haulCents" type="number" inputmode="decimal" value="35" />
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Tree Clearing (if needed)</div>
        <div class="grid2">
          <div>
            <label>Tree Count</label>
            <input id="s_treeCount" type="number" inputmode="numeric" placeholder="0" />
          </div>
          <div>
            <label>Tree Size</label>
            <select id="s_treeSize">
              <option value="0">None</option>
              <option value="500">Small (up to 6")</option>
              <option value="1000">Medium (6–12")</option>
              <option value="1500">Large (12"+)</option>
            </select>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Crew / Labor / Site Work</div>
        <div class="subnote">Chamber mode automatically reduces labor 15%.</div>
        <label>Crew Size</label>
        <select id="s_crew">
          <option value="1">1 Man / 1 Machine</option>
          <option value="1.3">2 Men / 2 Machines</option>
        </select>

        <label>Labor / Site Work / Mobilization Base ($)</label>
        <input id="s_laborBase" type="number" inputmode="decimal" placeholder="0" />
      </div>

      <button class="btn btn-yellow" onclick="calcSeptic()">CALCULATE TOTAL</button>
      <button class="btn btn-blue" onclick="showSepticVerbal()">VERBAL QUOTE (COPY)</button>
      <button class="btn btn-green" onclick="showSepticQuote()">VIEW / PRINT CUSTOMER QUOTE</button>
      <button class="btn btn-blue" onclick="saveCurrentJob('septic')">SAVE JOB OFFLINE</button>

      <div class="total" id="s_total">$0.00</div>
      <div class="subnote" style="text-align:center;margin-top:8px;">
        Minimum job price enforced: <b>$9,000</b>
      </div>
    </div>

    <!-- PAD -->
    <div id="page_pad" class="page">
      <h1>Pad Work Estimator</h1>
      <div class="company">Crest View Construction LLC</div>

      <div class="section">
        <div class="section-title">Job Info</div>
        <div class="grid2">
          <div>
            <label>Customer Name</label>
            <input id="p_customer" placeholder="Customer Name" />
          </div>
          <div>
            <label>Job #</label>
            <input id="p_job" placeholder="Job #" />
          </div>
        </div>
        <label>Job Location</label>
        <input id="p_location" placeholder="Job Location" />
      </div>

      <div class="section">
        <div class="section-title">Pad Dimensions</div>
        <div class="grid2">
          <div>
            <label>Length (ft)</label>
            <input id="p_len" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Width (ft)</label>
            <input id="p_wid" type="number" inputmode="decimal" placeholder="0" />
          </div>
        </div>
        <label>Average Depth (inches)</label>
        <input id="p_depthIn" type="number" inputmode="decimal" placeholder="0" />
      </div>

      <div class="section">
        <div class="section-title">Fill / Equipment / Labor</div>
        <div class="grid2">
          <div>
            <label>Fill Cost ($ per cubic yard)</label>
            <input id="p_fillPerYd" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Markup %</label>
            <input id="p_markup" type="number" inputmode="decimal" value="20" />
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>Equipment Hours</label>
            <input id="p_equipHours" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Equipment Rate ($/hr)</label>
            <input id="p_equipRate" type="number" inputmode="decimal" placeholder="0" />
          </div>
        </div>

        <label>Labor / Site Work Base ($)</label>
        <input id="p_labor" type="number" inputmode="decimal" placeholder="0" />
      </div>

      <button class="btn btn-yellow" onclick="calcPad()">CALCULATE PAD TOTAL</button>
      <button class="btn btn-blue" onclick="showPadVerbal()">VERBAL QUOTE (COPY)</button>
      <button class="btn btn-green" onclick="showPadQuote()">VIEW / PRINT CUSTOMER QUOTE</button>
      <button class="btn btn-blue" onclick="saveCurrentJob('pad')">SAVE JOB OFFLINE</button>

      <div class="total" id="p_total">$0.00</div>
    </div>

    <!-- LAND CLEARING -->
    <div id="page_clear" class="page">
      <h1>Land Clearing Estimator</h1>
      <div class="company">Crest View Construction LLC</div>

      <div class="section">
        <div class="section-title">Job Info</div>
        <div class="grid2">
          <div>
            <label>Customer Name</label>
            <input id="c_customer" placeholder="Customer Name" />
          </div>
          <div>
            <label>Job #</label>
            <input id="c_job" placeholder="Job #" />
          </div>
        </div>
        <label>Job Location</label>
        <input id="c_location" placeholder="Job Location" />
      </div>

      <div class="section">
        <div class="section-title">Acreage Pricing (Quick Presets)</div>
        <div class="subnote">Enter acres, then tap a preset to auto-fill $/acre (you can edit it).</div>

        <div class="grid2">
          <div>
            <label>Acres</label>
            <input id="c_acres" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>$ per Acre</label>
            <input id="c_perAcre" type="number" inputmode="decimal" placeholder="0" />
          </div>
        </div>

        <div class="presetRow">
          <button type="button" onclick="setClearPreset('light')">LIGHT</button>
          <button type="button" onclick="setClearPreset('medium')">MEDIUM</button>
          <button type="button" onclick="setClearPreset('heavy')">HEAVY</button>
        </div>

        <div class="subnote">
          Current default presets: Light $2,000/acre • Medium $3,000/acre • Heavy $4,000/acre (edit anytime).
        </div>
      </div>

      <div class="section">
        <div class="section-title">Tree Clearing</div>
        <div class="subnote">Tree pricing: Small/Medium/Large per tree.</div>
        <div class="grid2">
          <div>
            <label>Tree Count</label>
            <input id="c_treeCount" type="number" inputmode="numeric" placeholder="0" />
          </div>
          <div>
            <label>Tree Size</label>
            <select id="c_treeSize">
              <option value="0">None</option>
              <option value="250">Small (up to 6")</option>
              <option value="750">Medium (6–12")</option>
              <option value="1500">Large (12"+)</option>
            </select>
          </div>
        </div>

        <label>Brush / Light Clearing (optional $)</label>
        <input id="c_brush" type="number" inputmode="decimal" placeholder="0" />
      </div>

      <div class="section">
        <div class="section-title">Haul off (optional)</div>
        <div class="subnote">Cents per mile × round trip. Use for debris hauling, equipment moving, etc.</div>
        <div class="grid2">
          <div>
            <label>Haul Distance (miles one way)</label>
            <input id="c_haulMiles" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Haul Cost (cents per mile)</label>
            <input id="c_haulCents" type="number" inputmode="decimal" value="35" />
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Crew / Labor / Site Work</div>
        <label>Crew Size</label>
        <select id="c_crew">
          <option value="1">1 Man / 1 Machine</option>
          <option value="1.3">2 Men / 2 Machines</option>
        </select>

        <label>Labor / Site Work / Mobilization Base ($)</label>
        <input id="c_laborBase" type="number" inputmode="decimal" placeholder="0" />

        <label>Markup %</label>
        <input id="c_markup" type="number" inputmode="decimal" value="20" />
      </div>

      <button class="btn btn-yellow" onclick="calcClear()">CALCULATE TOTAL</button>
      <button class="btn btn-blue" onclick="showClearVerbal()">VERBAL QUOTE (COPY)</button>
      <button class="btn btn-green" onclick="showClearQuote()">VIEW / PRINT CUSTOMER QUOTE</button>
      <button class="btn btn-blue" onclick="saveCurrentJob('clear')">SAVE JOB OFFLINE</button>

      <div class="total" id="c_total">$0.00</div>
    </div>

  </div>
</div>

<!-- MODAL -->
<div id="quoteModal" class="modal" aria-hidden="true">
  <div class="modalCard">
    <div class="modalTop">
      <h2 id="modalTitle">Customer Quote</h2>
      <div class="modalBtns">
        <button class="copy" onclick="copyModalText()">COPY</button>
        <button class="print" onclick="window.print()">PRINT</button>
        <button class="close" onclick="closeQuote()">CLOSE</button>
      </div>
    </div>
    <div id="quoteContent"></div>
  </div>
</div>

<script>
/* Navigation */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  const el = document.getElementById(id);
  if(el) el.classList.add('active');
}
function goHome(){ showPage('page_home'); }
function openJobs(){ renderJobs(); showPage('page_jobs'); }

let septicMode = 'conventional';
function openSeptic(mode){
  septicMode = mode;
  document.getElementById('septicModePill').textContent =
    mode === 'chamber' ? 'CHAMBER (labor -15%, no rock)' : 'CONVENTIONAL';
  document.getElementById('septicTitle').textContent =
    mode === 'chamber' ? 'Chamber Septic Estimator' : 'Conventional Septic Estimator';
  showPage('page_septic');
}
function openPad(){ showPage('page_pad'); }
function openClear(){ showPage('page_clear'); }

/* Helpers */
function n(id){ return parseFloat(document.getElementById(id).value) || 0; }
function money(x){ return '$' + (Math.round(x * 100) / 100).toFixed(2); }
function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, m => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
  }[m]));
}
function cryptoRandomId(){
  if(window.crypto && crypto.getRandomValues){
    const a = new Uint32Array(3);
    crypto.getRandomValues(a);
    return Array.from(a).map(x=>x.toString(16)).join('');
  }
  return 'id_' + Math.random().toString(16).slice(2);
}

/* Modal */
let lastCopyText = "";
function openQuote(title, html, copyText){
  document.getElementById('modalTitle').textContent = title;
  document.getElementById('quoteContent').innerHTML = html;
  lastCopyText = copyText || "";
  const m = document.getElementById('quoteModal');
  m.classList.add('open');
  m.setAttribute('aria-hidden', 'false');
  window.scrollTo(0,0);
}
function closeQuote(){
  const m = document.getElementById('quoteModal');
  m.classList.remove('open');
  m.setAttribute('aria-hidden', 'true');
  document.getElementById('quoteContent').innerHTML = '';
  lastCopyText = "";
}
async function copyModalText(){
  const text = lastCopyText || (document.getElementById('quoteContent').innerText || "");
  try{
    await navigator.clipboard.writeText(text);
    alert("Copied ✅");
  }catch(e){
    const ta = document.createElement('textarea');
    ta.value = text;
    document.body.appendChild(ta);
    ta.select();
    document.execCommand('copy');
    document.body.removeChild(ta);
    alert("Copied ✅");
  }
}

/* Payment rules */
function depositAndTerms(total){
  if(total >= 10000){
    return { deposit: total * 0.15, terms: "Progress payments required as work progresses." };
  }
  return { deposit: 0, terms: "Payment due upon completion." };
}

/* ------------------ SEPTIC ------------------ */
function calcSeptic(){
  const tank = n('s_tank');
  const fieldFt = n('s_fieldFt');
  const pipePerFt = n('s_pipePerFt');
  const pipeTotal = fieldFt * pipePerFt;

  const rockTons = n('s_rockTons');
  const rockPerTon = n('s_rockPerTon');
  let rockTotal = rockTons * rockPerTon;

  const haulMilesOneWay = n('s_haulMiles');
  const haulCentsPerMile = n('s_haulCents');
  const haulTotal = (haulMilesOneWay * 2) * (haulCentsPerMile / 100);

  const trees = n('s_treeCount');
  const treeRate = n('s_treeSize');
  const treeTotal = trees * treeRate;

  const crewMult = n('s_crew');
  let laborBase = n('s_laborBase') * crewMult;

  const markupPct = n('s_markup');

  if(septicMode === 'chamber'){
    rockTotal = 0;
    laborBase = laborBase * 0.85;
  }

  let subtotal = (tank + pipeTotal + rockTotal + haulTotal + treeTotal) + laborBase;
  let total = subtotal + (subtotal * (markupPct / 100));

  const minApplied = total < 9000;
  if(minApplied) total = 9000;

  document.getElementById('s_total').textContent = money(total);

  return {
    mode: septicMode,
    customer: document.getElementById('s_customer').value || '',
    job: document.getElementById('s_job').value || '',
    location: document.getElementById('s_location').value || '',
    materialsBreakdown: { tank, pipeTotal, rockTotal, haulTotal, treeTotal },
    laborSite: laborBase,
    markupPct,
    total,
    minApplied
  };
}

function showSepticVerbal(){
  const r = calcSeptic();
  const dt = depositAndTerms(r.total);

  const materialsTotal =
    r.materialsBreakdown.tank +
    r.materialsBreakdown.pipeTotal +
    r.materialsBreakdown.rockTotal +
    r.materialsBreakdown.haulTotal +
    r.materialsBreakdown.treeTotal;

  const sys = (r.mode === 'chamber') ? "Chamber Septic" : "Conventional Septic";
  const minNote = r.minApplied ? " (min $9,000 applied)" : "";

  const html = `
    <div class="vCard">
      <p class="vBig">TOTAL: ${money(r.total)}</p>
      <p class="vLine">${sys}${minNote}</p>
      <div class="vSmall">
        <b>Customer:</b> ${escapeHtml(r.customer || "—")} &nbsp; | &nbsp;
        <b>Job #:</b> ${escapeHtml(r.job || "—")}<br>
        <b>Location:</b> ${escapeHtml(r.location || "—")}<br><br>
        <b>Quick breakdown:</b><br>
        Materials: ${money(materialsTotal)}<br>
        Labor / Site / Mobilization: ${money(r.laborSite)}<br>
        Markup: ${r.markupPct.toFixed(0)}%<br><br>
        <b>Deposit:</b> ${money(dt.deposit)}<br>
        <b>Terms:</b> ${escapeHtml(dt.terms)}
      </div>
    </div>
  `;

  const copyText =
`Crest View Construction LLC — VERBAL ESTIMATE
${sys}${minNote}
Customer: ${r.customer || "—"} | Job#: ${r.job || "—"}
Location: ${r.location || "—"}
TOTAL: ${money(r.total)}

Quick breakdown:
- Materials: ${money(materialsTotal)}
- Labor/Site/Mobilization: ${money(r.laborSite)}
- Markup: ${r.markupPct.toFixed(0)}%

Deposit: ${money(dt.deposit)}
Terms: ${dt.terms}`;

  openQuote("Verbal Quote (Copy/Share)", html, copyText);
}

function showSepticQuote(){
  const r = calcSeptic();
  const dt = depositAndTerms(r.total);

  const materialsTotal =
    r.materialsBreakdown.tank +
    r.materialsBreakdown.pipeTotal +
    r.materialsBreakdown.rockTotal +
    r.materialsBreakdown.haulTotal +
    r.materialsBreakdown.treeTotal;

  const html = `
    <h1 class="qTitle">Crest View Construction LLC</h1>
    <div class="qMuted">Septic System Estimate</div>

    <div class="qBox">
      <b>Customer:</b> ${escapeHtml(r.customer || '—')}<br>
      <b>Job #:</b> ${escapeHtml(r.job || '—')}<br>
      <b>Location:</b> ${escapeHtml(r.location || '—')}<br>
      <b>System Type:</b> ${r.mode === 'chamber' ? 'Chamber Septic' : 'Conventional Septic'}
    </div>

    <h2>Materials</h2>
    <table class="qTable">
      <tr><th>Description</th><th class="qRight">Amount</th></tr>
      <tr><td>Tank</td><td class="qRight">${money(r.materialsBreakdown.tank)}</td></tr>
      <tr><td>Pipe</td><td class="qRight">${money(r.materialsBreakdown.pipeTotal)}</td></tr>
      <tr><td>Rock</td><td class="qRight">${money(r.materialsBreakdown.rockTotal)}</td></tr>
      <tr><td>Hauling</td><td class="qRight">${money(r.materialsBreakdown.haulTotal)}</td></tr>
      <tr><td>Tree Clearing</td><td class="qRight">${money(r.materialsBreakdown.treeTotal)}</td></tr>
      <tr><td><b>Materials Subtotal</b></td><td class="qRight"><b>${money(materialsTotal)}</b></td></tr>
    </table>

    <h2>Labor / Site Work / Mobilization</h2>
    <table class="qTable">
      <tr><th>Description</th><th class="qRight">Amount</th></tr>
      <tr><td>Labor / Site Work / Mobilization</td><td class="qRight">${money(r.laborSite)}</td></tr>
    </table>

    <div class="qBox qTotal">Total Price: ${money(r.total)}</div>

    <div class="qBox">
      <b>Deposit to Schedule:</b> ${money(dt.deposit)}<br>
      <b>Payment Terms:</b> ${escapeHtml(dt.terms)}
    </div>

    <div class="qBox">
      <b>Scope:</b> Septic system installation including excavation, materials, labor, equipment, and site restoration per approved plans and local requirements.
    </div>

    <div class="sigline"></div><div>Customer Signature</div>
    <div class="sigline"></div><div>Date</div>
  `;

  const copyText =
`Crest View Construction LLC — QUOTE
Customer: ${r.customer || "—"} | Job#: ${r.job || "—"}
Location: ${r.location || "—"}
System: ${r.mode === 'chamber' ? 'Chamber Septic' : 'Conventional Septic'}
Total: ${money(r.total)}
Deposit: ${money(dt.deposit)}
Terms: ${dt.terms}`;

  openQuote("Customer Quote (Print/Share)", html, copyText);
}

/* ------------------ PAD ------------------ */
function calcPad(){
  const len = n('p_len');
  const wid = n('p_wid');
  const depthIn = n('p_depthIn');
  const depthFt = depthIn / 12;

  const cubicYards = (len * wid * depthFt) / 27;

  const fillPerYd = n('p_fillPerYd');
  const fillTotal = cubicYards * fillPerYd;

  const equipHours = n('p_equipHours');
  const equipRate = n('p_equipRate');
  const equipTotal = equipHours * equipRate;

  const labor = n('p_labor');
  const markupPct = n('p_markup');

  let subtotal = (fillTotal + equipTotal + labor);
  let total = subtotal + (subtotal * (markupPct/100));

  document.getElementById('p_total').textContent = money(total);

  return {
    customer: document.getElementById('p_customer').value || '',
    job: document.getElementById('p_job').value || '',
    location: document.getElementById('p_location').value || '',
    cubicYards,
    fillTotal,
    equipTotal,
    labor,
    markupPct,
    total
  };
}

function showPadVerbal(){
  const r = calcPad();
  const dt = depositAndTerms(r.total);

  const html = `
    <div class="vCard">
      <p class="vBig">TOTAL: ${money(r.total)}</p>
      <p class="vLine">Building Pad Work</p>
      <div class="vSmall">
        <b>Customer:</b> ${escapeHtml(r.customer || "—")} &nbsp; | &nbsp;
        <b>Job #:</b> ${escapeHtml(r.job || "—")}<br>
        <b>Location:</b> ${escapeHtml(r.location || "—")}<br><br>
        <b>Quick breakdown:</b><br>
        Fill volume: ${r.cubicYards.toFixed(2)} yd³<br>
        Fill: ${money(r.fillTotal)}<br>
        Equipment: ${money(r.equipTotal)}<br>
        Labor / Site Work: ${money(r.labor)}<br>
        Markup: ${r.markupPct.toFixed(0)}%<br><br>
        <b>Deposit:</b> ${money(dt.deposit)}<br>
        <b>Terms:</b> ${escapeHtml(dt.terms)}
      </div>
    </div>
  `;

  const copyText =
`Crest View Construction LLC — VERBAL ESTIMATE
Building Pad Work
Customer: ${r.customer || "—"} | Job#: ${r.job || "—"}
Location: ${r.location || "—"}
TOTAL: ${money(r.total)}

Quick breakdown:
- Fill volume: ${r.cubicYards.toFixed(2)} yd³
- Fill: ${money(r.fillTotal)}
- Equipment: ${money(r.equipTotal)}
- Labor/Site: ${money(r.labor)}
- Markup: ${r.markupPct.toFixed(0)}%

Deposit: ${money(dt.deposit)}
Terms: ${dt.terms}`;

  openQuote("Verbal Quote (Copy/Share)", html, copyText);
}

function showPadQuote(){
  const r = calcPad();
  const dt = depositAndTerms(r.total);

  const html = `
    <h1 class="qTitle">Crest View Construction LLC</h1>
    <div class="qMuted">Building Pad Estimate</div>

    <div class="qBox">
      <b>Customer:</b> ${escapeHtml(r.customer || '—')}<br>
      <b>Job #:</b> ${escapeHtml(r.job || '—')}<br>
      <b>Location:</b> ${escapeHtml(r.location || '—')}<br>
      <b>Estimated Fill Volume:</b> ${r.cubicYards.toFixed(2)} yd³
    </div>

    <h2>Costs</h2>
    <table class="qTable">
      <tr><th>Description</th><th class="qRight">Amount</th></tr>
      <tr><td>Fill Material</td><td class="qRight">${money(r.fillTotal)}</td></tr>
      <tr><td>Equipment</td><td class="qRight">${money(r.equipTotal)}</td></tr>
      <tr><td>Labor / Site Work</td><td class="qRight">${money(r.labor)}</td></tr>
    </table>

    <div class="qBox qTotal">Total Price: ${money(r.total)}</div>

    <div class="qBox">
      <b>Deposit to Schedule:</b> ${money(dt.deposit)}<br>
      <b>Payment Terms:</b> ${escapeHtml(dt.terms)}
    </div>

    <div class="qBox">
      <b>Scope:</b> Building pad construction including grading, placement of fill material as needed, equipment operation, and final shaping/leveling suitable for building/foundation preparation.
    </div>

    <div class="sigline"></div><div>Customer Signature</div>
    <div class="sigline"></div><div>Date</div>
  `;

  const copyText =
`Crest View Construction LLC — QUOTE
Customer: ${r.customer || "—"} | Job#: ${r.job || "—"}
Location: ${r.location || "—"}
Total: ${money(r.total)}
Deposit: ${money(dt.deposit)}
Terms: ${dt.terms}`;

  openQuote("Customer Quote (Print/Share)", html, copyText);
}

/* ------------------ LAND CLEARING ------------------ */
function setClearPreset(which){
  // You can change these preset numbers anytime
  const presets = {
    light: 2000,
    medium: 3200,
    heavy: 4500
  };
  const val = presets[which] ?? 0;
  document.getElementById('c_perAcre').value = val;
}

function calcClear(){
  const acres = n('c_acres');
  const perAcre = n('c_perAcre');
  const acreTotal = acres * perAcre;

  const trees = n('c_treeCount');
  const treeRate = n('c_treeSize');
  const treeTotal = trees * treeRate;

  const brush = n('c_brush');

  const haulMilesOneWay = n('c_haulMiles');
  const haulCentsPerMile = n('c_haulCents');
  const haulTotal = (haulMilesOneWay * 2) * (haulCentsPerMile / 100);

  const crewMult = n('c_crew');
  const laborBase = n('c_laborBase') * crewMult;

  const markupPct = n('c_markup');

  const materials = acreTotal + treeTotal + brush + haulTotal;
  const laborSite = laborBase;

  let subtotal = materials + laborSite;
  let total = subtotal + (subtotal * (markupPct / 100));

  document.getElementById('c_total').textContent = money(total);

  return {
    customer: document.getElementById('c_customer').value || '',
    job: document.getElementById('c_job').value || '',
    location: document.getElementById('c_location').value || '',
    acres, perAcre, acreTotal,
    trees, treeRate, treeTotal,
    brush,
    haulTotal,
    laborSite,
    markupPct,
    total
  };
}

function showClearVerbal(){
  const r = calcClear();
  const dt = depositAndTerms(r.total);

  const materialsTotal = r.acreTotal + r.treeTotal + r.brush + r.haulTotal;

  const html = `
    <div class="vCard">
      <p class="vBig">TOTAL: ${money(r.total)}</p>
      <p class="vLine">Land Clearing</p>
      <div class="vSmall">
        <b>Customer:</b> ${escapeHtml(r.customer || "—")} &nbsp; | &nbsp;
        <b>Job #:</b> ${escapeHtml(r.job || "—")}<br>
        <b>Location:</b> ${escapeHtml(r.location || "—")}<br><br>

        <b>Quick breakdown:</b><br>
        Acreage (${r.acres || 0} ac @ ${money(r.perAcre)}/ac): ${money(r.acreTotal)}<br>
        Trees: ${money(r.treeTotal)}<br>
        Brush/Light Clearing: ${money(r.brush)}<br>
        Haul off: ${money(r.haulTotal)}<br>
        Materials Subtotal: ${money(materialsTotal)}<br>
        Labor / Site Work: ${money(r.laborSite)}<br>
        Markup: ${r.markupPct.toFixed(0)}%<br><br>

        <b>Deposit:</b> ${money(dt.deposit)}<br>
        <b>Terms:</b> ${escapeHtml(dt.terms)}
      </div>
    </div>
  `;

  const copyText =
`Crest View Construction LLC — VERBAL ESTIMATE
Land Clearing
Customer: ${r.customer || "—"} | Job#: ${r.job || "—"}
Location: ${r.location || "—"}
TOTAL: ${money(r.total)}

Quick breakdown:
- Acreage (${r.acres || 0} ac @ ${money(r.perAcre)}/ac): ${money(r.acreTotal)}
- Trees: ${money(r.treeTotal)}
- Brush/Light Clearing: ${money(r.brush)}
- Hauling off: ${money(r.haulTotal)}
- Labor/Site: ${money(r.laborSite)}
- Markup: ${r.markupPct.toFixed(0)}%

Deposit: ${money(dt.deposit)}
Terms: ${dt.terms}`;

  openQuote("Verbal Quote (Copy/Share)", html, copyText);
}

function showClearQuote(){
  const r = calcClear();
  const dt = depositAndTerms(r.total);

  const materialsTotal = r.acreTotal + r.treeTotal + r.brush + r.haulTotal;

  const html = `
  <h1 class="qTitle" style="color:#0ea5e9;">Crest View Construction LLC</h1>
  <div class="qMuted">Land Clearing Estimate</div>

  <div class="qBox">
    <b>Customer:</b> ${escapeHtml(r.customer || '—')}<br>
    <b>Job #:</b> ${escapeHtml(r.job || '—')}<br>
    <b>Location:</b> ${escapeHtml(r.location || '—')}
  </div>

  <h2>Site Costs</h2>
  <table class="qTable">
    <tr><th>Description</th><th class="qRight">Amount</th></tr>

    <tr>
      <td>Acreage Clearing (${r.acres || 0} ac @ ${money(r.perAcre)}/ac)</td>
      <td class="qRight">${money(r.acreTotal)}</td>
    </tr>

    <tr>
      <td>Brush / Light Clearing</td>
      <td class="qRight">${money(r.brush)}</td>
    </tr>

    <tr>
      <td>Haul Off</td>
      <td class="qRight">${money(r.haul)}</td>
    </tr>

    <tr>
      <td><b>Site Costs Subtotal</b></td>
      <td class="qRight">
        <b>${money(r.acreTotal + r.brush + r.haul)}</b>
      </td>
    </tr>
  </table>

  <h2>Labor / Site Work</h2>
  <table class="qTable">
    <tr><th>Description</th><th class="qRight">Amount</th></tr>
    <tr>
      <td>Labor / Site Work</td>
      <td class="qRight">${money(r.laborSite)}</td>
    </tr>
  </table>

  <div class="qBox qTotal">Total Price: ${money(r.total)}</div>

  <div class="qBox">
    <b>Deposit to Schedule:</b> ${money(dt.deposit)}<br>
    <b>Payment Terms:</b> ${escapeHtml(dt.terms)}
  </div>

  <div class="qBox">
    <b>Scope:</b> Site clearing including acreage clearing and brush/light clearing, with optional haul off as selected. Final pricing subject to site access and actual field conditions.
  </div>

  <div class="sigline"></div><div>Customer Signature</div>
  <div class="sigline"></div><div>Date</div>
`;

  const copyText =
`Crest View Construction LLC — QUOTE
Land Clearing
Customer: ${r.customer || "—"} | Job#: ${r.job || "—"}
Location: ${r.location || "—"}
Total: ${money(r.total)}
Deposit: ${money(dt.deposit)}
Terms: ${dt.terms}`;

  openQuote("Customer Quote (Print/Share)", html, copyText);
}

/* ------------------ OFFLINE SAVE / LOAD ------------------ */
const JOBS_KEY = 'cv_jobs_v1';

function getJobs(){
  try { return JSON.parse(localStorage.getItem(JOBS_KEY) || '[]'); }
  catch { return []; }
}
function setJobs(jobs){
  localStorage.setItem(JOBS_KEY, JSON.stringify(jobs));
}

function saveCurrentJob(type){
  const now = new Date();
  const stamp = now.toISOString();

  let payload;
  if(type === 'septic') payload = { type:'septic', data: calcSeptic() };
  else if(type === 'pad') payload = { type:'pad', data: calcPad() };
  else payload = { type:'clear', data: calcClear() };

  const name = (payload.data.customer || '').trim();
  const jobNo = (payload.data.job || '').trim();
  const label = `${type.toUpperCase()} • ${name || 'No Name'} • ${jobNo || 'No Job#'} • ${now.toLocaleString()}`;

  const jobs = getJobs();
  jobs.unshift({ id: cryptoRandomId(), label, createdAt: stamp, payload });
  setJobs(jobs);
  alert('Saved offline ✅');
}

function renderJobs(){
  const wrap = document.getElementById('jobsList');
  const jobs = getJobs();
  wrap.innerHTML = '';

  if(!jobs.length){
    wrap.innerHTML = '<div class="subnote">No saved jobs yet.</div>';
    return;
  }

  jobs.forEach(j=>{
    const div = document.createElement('div');
    div.className = 'jobItem';
    div.innerHTML = `
      <b>${escapeHtml(j.label)}</b>
      <div class="subnote">Saved: ${new Date(j.createdAt).toLocaleString()}</div>
      <div class="row">
        <button class="btn-blue" onclick="loadJob('${j.id}')">Load</button>
        <button class="btn-danger" onclick="deleteJob('${j.id}')">Delete</button>
      </div>
    `;
    wrap.appendChild(div);
  });
}

function deleteJob(id){
  const jobs = getJobs().filter(j=>j.id !== id);
  setJobs(jobs);
  renderJobs();
}

function loadJob(id){
  const jobs = getJobs();
  const found = jobs.find(j=>j.id === id);
  if(!found){ alert('Job not found'); return; }

  const { type, data } = found.payload;

  if(type === 'septic'){
    openSeptic(data.mode || 'conventional');
    document.getElementById('s_customer').value = data.customer || '';
    document.getElementById('s_job').value = data.job || '';
    document.getElementById('s_location').value = data.location || '';
    alert('Loaded job ✅ (Re-enter estimate inputs if needed, then Calculate)');
  } else if(type === 'pad'){
    openPad();
    document.getElementById('p_customer').value = data.customer || '';
    document.getElementById('p_job').value = data.job || '';
    document.getElementById('p_location').value = data.location || '';
    alert('Loaded job ✅ (Re-enter estimate inputs if needed, then Calculate)');
  } else {
    openClear();
    document.getElementById('c_customer').value = data.customer || '';
    document.getElementById('c_job').value = data.job || '';
    document.getElementById('c_location').value = data.location || '';
    alert('Loaded job ✅ (Verify inputs, then Calculate)');
  }
}

/* default */
goHome();
</script>

</body>
</html>