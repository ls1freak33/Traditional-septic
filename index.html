<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Construction Estimator</title>

<style>
  :root{
    --bg:#000;
    --panel:#0b0b0b;
    --panel2:#050505;
    --yellow:#facc15;
    --white:#fff;
    --company:#38bdf8;
    --green:#22c55e;
    --blue:#2563eb;
    --danger:#dc2626;
    --muted:#bdbdbd;
  }

  *{ box-sizing:border-box; }

  body{
    margin:0;
    background:var(--bg);
    color:var(--white);
    font-family:Arial, sans-serif;
  }

  /* Top nav */
  .nav{
    display:flex;
    gap:10px;
    padding:10px;
    justify-content:center;
    flex-wrap:wrap;
    border-bottom:2px solid var(--yellow);
    background:#000;
    position:sticky;
    top:0;
    z-index:10;
  }
  .nav button{
    background:var(--yellow);
    color:#000;
    border:none;
    padding:12px 16px;
    border-radius:10px;
    font-weight:800;
    cursor:pointer;
    min-width:120px;
  }

  .container{
    max-width:760px;
    margin:0 auto;
    padding:14px;
  }

  .card{
    border:2px solid var(--yellow);
    border-radius:14px;
    background:var(--panel2);
    padding:14px;
  }

  h1{
    text-align:center;
    color:var(--yellow);
    font-size:34px;
    margin:8px 0 6px;
    letter-spacing:0.5px;
  }

  .company{
    text-align:center;
    color:var(--company);
    font-weight:800;
    font-size:18px;
    margin-bottom:14px;
  }

  .section{
    border:1px solid var(--yellow);
    border-radius:12px;
    padding:12px;
    margin:12px 0;
    background:var(--panel);
  }
  .section-title{
    color:var(--yellow);
    font-weight:900;
    font-size:18px;
    margin-bottom:10px;
  }

  .grid2{
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;
  }
  @media (max-width:640px){
    .grid2{ grid-template-columns:1fr; }
    h1{ font-size:30px; }
    .nav button{ flex:1 1 45%; }
  }

  label{
    display:block;
    font-size:13px;
    color:var(--muted);
    margin:2px 0 6px;
    font-weight:700;
  }

  input, select, textarea{
    width:100%;
    padding:11px;
    margin-bottom:10px;
    background:#000;
    border:1px solid var(--yellow);
    border-radius:10px;
    color:var(--white);
    font-size:16px;
    outline:none;
  }

  .btn{
    width:100%;
    padding:14px;
    border:none;
    border-radius:12px;
    font-weight:900;
    font-size:16px;
    cursor:pointer;
    margin-top:10px;
  }
  .btn-yellow{ background:var(--yellow); color:#000; }
  .btn-green{ background:var(--green); color:#000; }
  .btn-blue{ background:var(--blue); color:#fff; }
  .btn-danger{ background:var(--danger); color:#fff; }

  .total{
    text-align:center;
    font-size:30px;
    font-weight:1000;
    color:var(--yellow);
    margin-top:12px;
  }

  .subnote{
    font-size:12px;
    color:var(--muted);
    margin-top:-6px;
    margin-bottom:10px;
  }

  .page{ display:none; }
  .page.active{ display:block; }

  .pill{
    display:inline-block;
    padding:6px 10px;
    border:1px solid var(--yellow);
    border-radius:999px;
    color:var(--yellow);
    font-weight:900;
    font-size:12px;
  }

  .jobList{
    display:flex;
    flex-direction:column;
    gap:10px;
  }

  .jobItem{
    border:1px solid #444;
    border-radius:12px;
    padding:10px;
    background:#070707;
  }
  .jobItem b{ color:var(--yellow); }
  .jobItem .row{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
    margin-top:8px;
  }
  .jobItem .row button{
    flex:1 1 120px;
    padding:10px;
    border-radius:10px;
    border:none;
    font-weight:900;
    cursor:pointer;
  }

  .photoPreview{
    display:flex;
    gap:8px;
    flex-wrap:wrap;
  }
  .photoPreview img{
    width:90px;
    height:90px;
    object-fit:cover;
    border-radius:10px;
    border:1px solid var(--yellow);
  }
</style>
</head>

<body>

<div class="nav">
  <button onclick="goHome()">Home</button>
  <button onclick="openSeptic('conventional')">Conventional Septic</button>
  <button onclick="openSeptic('chamber')">Chamber Septic</button>
  <button onclick="openPad()">Pad Work</button>
</div>

<div class="container">
  <div class="card">

    <!-- HOME -->
    <div id="page_home" class="page active">
      <h1>Construction Estimator</h1>
      <div class="company">Crest View Construction LLC</div>

      <div class="section">
        <div class="section-title">Start</div>
        <p style="margin:0; line-height:1.4;">
          Use the buttons at the top to switch between estimators.
          Save jobs offline so you can pull them up later even with no service.
        </p>
      </div>

      <div class="section">
        <div class="section-title">Saved Jobs</div>
        <button class="btn btn-blue" onclick="openJobs()">View / Load Saved Jobs</button>
      </div>
    </div>

    <!-- JOBS -->
    <div id="page_jobs" class="page">
      <h1>Saved Jobs</h1>
      <div class="company">Crest View Construction LLC</div>

      <div class="section">
        <div class="section-title">Jobs Stored Offline</div>
        <div class="subnote">Stored in this phone/browser (localStorage). Photos are preview-only for now.</div>
        <div id="jobsList" class="jobList"></div>
        <button class="btn btn-yellow" onclick="goHome()">Back</button>
      </div>
    </div>

    <!-- SEPTIC -->
    <div id="page_septic" class="page">
      <h1 id="septicTitle">Septic Estimator</h1>
      <div class="company">Crest View Construction LLC</div>
      <div style="text-align:center; margin-bottom:10px;">
        <span class="pill" id="septicModePill">MODE</span>
      </div>

      <div class="section">
        <div class="section-title">Job Info</div>
        <div class="grid2">
          <div>
            <label>Customer Name</label>
            <input id="s_customer" placeholder="Customer Name" />
          </div>
          <div>
            <label>Job #</label>
            <input id="s_job" placeholder="Job #" />
          </div>
        </div>
        <label>Job Location</label>
        <input id="s_location" placeholder="Job Location" />
      </div>

      <div class="section">
        <div class="section-title">Site Photos (preview only)</div>
        <input id="s_photos" type="file" accept="image/*" multiple />
        <div class="subnote">Photos preview on screen; not saved offline yet.</div>
        <div id="s_photoPreview" class="photoPreview"></div>
      </div>

      <div class="section">
        <div class="section-title">System Details</div>
        <div class="grid2">
          <div>
            <label>Tank Cost ($)</label>
            <input id="s_tank" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Field Line Length (ft)</label>
            <input id="s_fieldFt" type="number" inputmode="decimal" placeholder="0" />
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>Pipe $ / ft</label>
            <input id="s_pipePerFt" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Markup %</label>
            <input id="s_markup" type="number" inputmode="decimal" placeholder="20" value="20" />
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Rock (Hauled In)</div>
        <div class="subnote">Rock is priced by tons (default $17/ton). Chamber mode removes rock automatically.</div>
        <div class="grid2">
          <div>
            <label>Rock Tons</label>
            <input id="s_rockTons" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Cost per Ton ($)</label>
            <input id="s_rockPerTon" type="number" inputmode="decimal" value="17" />
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Hauling</div>
        <div class="subnote">Haul cost is in cents per mile (ex: 35 = $0.35/mi). Distance is one-way.</div>
        <div class="grid2">
          <div>
            <label>Haul Distance (miles one way)</label>
            <input id="s_haulMiles" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Haul Cost (cents per mile)</label>
            <input id="s_haulCents" type="number" inputmode="decimal" value="35" />
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Tree Clearing (if needed)</div>
        <div class="grid2">
          <div>
            <label>Tree Count</label>
            <input id="s_treeCount" type="number" inputmode="numeric" placeholder="0" />
          </div>
          <div>
            <label>Tree Size</label>
            <select id="s_treeSize">
              <option value="0">None</option>
              <option value="500">Small (up to 6")</option>
              <option value="1000">Medium (6–12")</option>
              <option value="1500">Large (12"+)</option>
            </select>
          </div>
        </div>
      </div>

      <div class="section">
        <div class="section-title">Crew / Labor / Site Work</div>
        <div class="subnote">Chamber mode automatically reduces labor 15%.</div>
        <label>Crew Size</label>
        <select id="s_crew">
          <option value="1">1 Man / 1 Machine</option>
          <option value="1.3">2 Men / 2 Machines</option>
        </select>

        <label>Labor / Site Work / Mobilization Base ($)</label>
        <input id="s_laborBase" type="number" inputmode="decimal" placeholder="0" />
      </div>

      <button class="btn btn-yellow" onclick="calcSeptic()">CALCULATE TOTAL</button>
      <button class="btn btn-green" onclick="printSepticQuote()">GENERATE CUSTOMER QUOTE</button>
      <button class="btn btn-blue" onclick="saveCurrentJob('septic')">SAVE JOB OFFLINE</button>

      <div class="total" id="s_total">$0.00</div>
      <div class="subnote" style="text-align:center;margin-top:8px;">
        Minimum job price enforced: <b>$9,000</b>
      </div>
    </div>

    <!-- PAD -->
    <div id="page_pad" class="page">
      <h1>Pad Work Estimator</h1>
      <div class="company">Crest View Construction LLC</div>

      <div class="section">
        <div class="section-title">Job Info</div>
        <div class="grid2">
          <div>
            <label>Customer Name</label>
            <input id="p_customer" placeholder="Customer Name" />
          </div>
          <div>
            <label>Job #</label>
            <input id="p_job" placeholder="Job #" />
          </div>
        </div>
        <label>Job Location</label>
        <input id="p_location" placeholder="Job Location" />
      </div>

      <div class="section">
        <div class="section-title">Pad Dimensions</div>
        <div class="grid2">
          <div>
            <label>Length (ft)</label>
            <input id="p_len" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Width (ft)</label>
            <input id="p_wid" type="number" inputmode="decimal" placeholder="0" />
          </div>
        </div>
        <label>Average Depth (inches)</label>
        <input id="p_depthIn" type="number" inputmode="decimal" placeholder="0" />
      </div>

      <div class="section">
        <div class="section-title">Fill / Equipment / Labor</div>

        <div class="grid2">
          <div>
            <label>Fill Cost ($ per cubic yard)</label>
            <input id="p_fillPerYd" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Markup %</label>
            <input id="p_markup" type="number" inputmode="decimal" value="20" />
          </div>
        </div>

        <div class="grid2">
          <div>
            <label>Equipment Hours</label>
            <input id="p_equipHours" type="number" inputmode="decimal" placeholder="0" />
          </div>
          <div>
            <label>Equipment Rate ($/hr)</label>
            <input id="p_equipRate" type="number" inputmode="decimal" placeholder="0" />
          </div>
        </div>

        <label>Labor / Site Work Base ($)</label>
        <input id="p_labor" type="number" inputmode="decimal" placeholder="0" />
      </div>

      <button class="btn btn-yellow" onclick="calcPad()">CALCULATE PAD TOTAL</button>
      <button class="btn btn-green" onclick="printPadQuote()">GENERATE CUSTOMER QUOTE</button>
      <button class="btn btn-blue" onclick="saveCurrentJob('pad')">SAVE JOB OFFLINE</button>

      <div class="total" id="p_total">$0.00</div>
      <div class="subnote" style="text-align:center;margin-top:8px;">
        Pad volume uses: (L × W × depth(ft)) ÷ 27
      </div>
    </div>

  </div>
</div>

<script>
/* Navigation */
function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}
function goHome(){ showPage('page_home'); }
function openJobs(){ renderJobs(); showPage('page_jobs'); }

let septicMode = 'conventional';
function openSeptic(mode){
  septicMode = mode;
  document.getElementById('septicModePill').textContent =
    mode === 'chamber' ? 'CHAMBER (labor -15%, no rock)' : 'CONVENTIONAL';
  document.getElementById('septicTitle').textContent =
    mode === 'chamber' ? 'Chamber Septic Estimator' : 'Conventional Septic Estimator';
  showPage('page_septic');
}
function openPad(){ showPage('page_pad'); }

/* Helpers */
function n(id){ return parseFloat(document.getElementById(id).value) || 0; }
function money(x){ return '$' + (Math.round(x * 100) / 100).toFixed(2); }

/* Photo preview */
document.getElementById('s_photos').addEventListener('change', (e)=>{
  const wrap = document.getElementById('s_photoPreview');
  wrap.innerHTML = '';
  const files = Array.from(e.target.files || []);
  files.slice(0, 12).forEach(file=>{
    const img = document.createElement('img');
    img.alt = 'photo';
    img.src = URL.createObjectURL(file);
    wrap.appendChild(img);
  });
});

/* Septic calculator */
function calcSeptic(){
  const tank = n('s_tank');
  const fieldFt = n('s_fieldFt');
  const pipePerFt = n('s_pipePerFt');
  const pipeTotal = fieldFt * pipePerFt;

  const rockTons = n('s_rockTons');
  const rockPerTon = n('s_rockPerTon');
  let rockTotal = rockTons * rockPerTon;

  const haulMilesOneWay = n('s_haulMiles');
  const haulCentsPerMile = n('s_haulCents');
  const haulTotal = (haulMilesOneWay * 2) * (haulCentsPerMile / 100);

  const trees = n('s_treeCount');
  const treeRate = n('s_treeSize');
  const treeTotal = trees * treeRate;

  const crewMult = n('s_crew');
  let laborBase = n('s_laborBase') * crewMult;

  const markupPct = n('s_markup');

  if(septicMode === 'chamber'){
    rockTotal = 0;
    laborBase = laborBase * 0.85;
  }

  let subtotal = (tank + pipeTotal + rockTotal + haulTotal + treeTotal) + laborBase;
  let total = subtotal + (subtotal * (markupPct / 100));

  if(total < 9000) total = 9000;

  document.getElementById('s_total').textContent = money(total);

  return {
    mode: septicMode,
    customer: document.getElementById('s_customer').value || '',
    job: document.getElementById('s_job').value || '',
    location: document.getElementById('s_location').value || '',
    materialsBreakdown: { tank, pipeTotal, rockTotal, haulTotal, treeTotal },
    laborSite: laborBase,
    markupPct,
    total
  };
}

/* ✅ FIXED: no <script>window.print()</script> inside the quote HTML */
function printSepticQuote(){
  const r = calcSeptic();
  const deposit = r.total >= 10000 ? r.total * 0.15 : 0;
  const paymentTerms = r.total >= 10000
    ? "Progress payments required as work progresses."
    : "Payment due upon completion.";

  const materialsTotal =
    r.materialsBreakdown.tank +
    r.materialsBreakdown.pipeTotal +
    r.materialsBreakdown.rockTotal +
    r.materialsBreakdown.haulTotal +
    r.materialsBreakdown.treeTotal;

  const win = window.open('', '_blank');
  win.document.write(`
    <html>
    <head>
      <title>Proposal</title>
      <style>
        body { font-family: Arial; padding: 40px; }
        h1 { text-align: center; margin:0; }
        h2 { margin-top:20px; }
        table { width:100%; border-collapse:collapse; margin-top:10px; }
        td,th { border:1px solid #ddd; padding:10px; }
        .right { text-align:right; }
        .line { border-top: 1px solid #000; width: 300px; margin-top: 40px; }
      </style>
    </head>
    <body>

      <h1>Crest View Construction LLC</h1>
      <p><strong>Customer:</strong> ${escapeHtml(r.customer || "Customer")}<br>
      <strong>Job #:</strong> ${escapeHtml(r.job || "—")}<br>
      <strong>Location:</strong> ${escapeHtml(r.location || "Job Site")}</p>

      <h2>Materials</h2>
      <table>
        <tr><th>Description</th><th class="right">Amount</th></tr>
        <tr><td>Tank</td><td class="right">${money(r.materialsBreakdown.tank)}</td></tr>
        <tr><td>Pipe</td><td class="right">${money(r.materialsBreakdown.pipeTotal)}</td></tr>
        <tr><td>Rock</td><td class="right">${money(r.materialsBreakdown.rockTotal)}</td></tr>
        <tr><td>Hauling</td><td class="right">${money(r.materialsBreakdown.haulTotal)}</td></tr>
        <tr><td>Tree Clearing</td><td class="right">${money(r.materialsBreakdown.treeTotal)}</td></tr>
        <tr><td><strong>Materials Subtotal</strong></td><td class="right"><strong>${money(materialsTotal)}</strong></td></tr>
      </table>

      <h2>Labor / Site Work / Mobilization</h2>
      <table>
        <tr><th>Description</th><th class="right">Amount</th></tr>
        <tr><td>Labor / Site Work / Mobilization</td><td class="right">${money(r.laborSite)}</td></tr>
      </table>

      <h2>Total Project Price: ${money(r.total)}</h2>
      <p><strong>Deposit to Schedule:</strong> ${money(deposit)}</p>
      <p><strong>Payment Terms:</strong> ${paymentTerms}</p>

      <p><strong>Acceptance of Proposal:</strong></p>
      <div class="line"></div>
      <p>Customer Signature</p>

      <div class="line"></div>
      <p>Date</p>

    </body>
    </html>
  `);
  win.document.close();
  win.focus();
  setTimeout(()=>win.print(), 250);
}

/* Pad calculator */
function calcPad(){
  const len = n('p_len');
  const wid = n('p_wid');
  const depthIn = n('p_depthIn');
  const depthFt = depthIn / 12;

  const cubicYards = (len * wid * depthFt) / 27;

  const fillPerYd = n('p_fillPerYd');
  const fillTotal = cubicYards * fillPerYd;

  const equipHours = n('p_equipHours');
  const equipRate = n('p_equipRate');
  const equipTotal = equipHours * equipRate;

  const labor = n('p_labor');
  const markupPct = n('p_markup');

  const materials = fillTotal;
  const laborSite = equipTotal + labor;

  let subtotal = materials + laborSite;
  let total = subtotal + (subtotal * (markupPct/100));

  document.getElementById('p_total').textContent = money(total);

  return {
    customer: document.getElementById('p_customer').value || '',
    job: document.getElementById('p_job').value || '',
    location: document.getElementById('p_location').value || '',
    cubicYards,
    materials,
    laborSite,
    markupPct,
    total,
    breakdown: { fillTotal, equipTotal, labor }
  };
}

/* ✅ FIXED: no <script>window.print()</script> inside the quote HTML */
function printPadQuote(){
  const r = calcPad();
  const deposit = r.total >= 10000 ? r.total * 0.15 : 0;
  const paymentTerms = r.total >= 10000
    ? "Progress payments required as work progresses."
    : "Payment due upon completion.";

  const win = window.open('', '_blank');
  win.document.write(`
    <html>
    <head>
      <title>Proposal</title>
      <style>
        body { font-family: Arial; padding: 40px; }
        h1 { text-align: center; margin:0; }
        h2 { margin-top:20px; }
        table { width:100%; border-collapse:collapse; margin-top:10px; }
        td,th { border:1px solid #ddd; padding:10px; }
        .right { text-align:right; }
        .line { border-top: 1px solid #000; width: 300px; margin-top: 40px; }
      </style>
    </head>
    <body>

      <h1>Crest View Construction LLC</h1>
      <p><strong>Customer:</strong> ${escapeHtml(r.customer || "Customer")}<br>
      <strong>Job #:</strong> ${escapeHtml(r.job || "—")}<br>
      <strong>Location:</strong> ${escapeHtml(r.location || "Job Site")}</p>

      <h2>Pad Details</h2>
      <p><strong>Estimated Fill:</strong> ${r.cubicYards.toFixed(2)} yd³</p>

      <h2>Materials</h2>
      <table>
        <tr><th>Description</th><th class="right">Amount</th></tr>
        <tr><td>Fill Material</td><td class="right">${money(r.breakdown.fillTotal)}</td></tr>
        <tr><td><strong>Materials Subtotal</strong></td><td class="right"><strong>${money(r.materials)}</strong></td></tr>
      </table>

      <h2>Labor / Equipment / Mobilization</h2>
      <table>
        <tr><th>Description</th><th class="right">Amount</th></tr>
        <tr><td>Equipment</td><td class="right">${money(r.breakdown.equipTotal)}</td></tr>
        <tr><td>Labor / Site Work</td><td class="right">${money(r.breakdown.labor)}</td></tr>
        <tr><td><strong>Labor Subtotal</strong></td><td class="right"><strong>${money(r.laborSite)}</strong></td></tr>
      </table>

      <h2>Total Project Price: ${money(r.total)}</h2>
      <p><strong>Deposit to Schedule:</strong> ${money(deposit)}</p>
      <p><strong>Payment Terms:</strong> ${paymentTerms}</p>

      <p><strong>Acceptance of Proposal:</strong></p>
      <div class="line"></div>
      <p>Customer Signature</p>

      <div class="line"></div>
      <p>Date</p>

    </body>
    </html>
  `);
  win.document.close();
  win.focus();
  setTimeout(()=>win.print(), 250);
}

/* Offline Save / Load */
const JOBS_KEY = 'cv_jobs_v1';

function getJobs(){
  try { return JSON.parse(localStorage.getItem(JOBS_KEY) || '[]'); }
  catch { return []; }
}
function setJobs(jobs){
  localStorage.setItem(JOBS_KEY, JSON.stringify(jobs));
}

function saveCurrentJob(type){
  const now = new Date();
  const stamp = now.toISOString();

  let payload;
  if(type === 'septic'){
    payload = { type:'septic', data: calcSeptic() };
  } else {
    payload = { type:'pad', data: calcPad() };
  }

  const name = (payload.data.customer || '').trim();
  const jobNo = (payload.data.job || '').trim();
  const label = `${type.toUpperCase()} • ${name || 'No Name'} • ${jobNo || 'No Job#'} • ${now.toLocaleString()}`;

  const jobs = getJobs();
  jobs.unshift({
    id: cryptoRandomId(),
    label,
    createdAt: stamp,
    payload
  });
  setJobs(jobs);
  alert('Saved offline ✅');
}

function renderJobs(){
  const wrap = document.getElementById('jobsList');
  const jobs = getJobs();
  wrap.innerHTML = '';

  if(!jobs.length){
    wrap.innerHTML = '<div class="subnote">No saved jobs yet.</div>';
    return;
  }

  jobs.forEach(j=>{
    const div = document.createElement('div');
    div.className = 'jobItem';
    div.innerHTML = `
      <b>${escapeHtml(j.label)}</b>
      <div class="subnote">Saved: ${new Date(j.createdAt).toLocaleString()}</div>
      <div class="row">
        <button class="btn-blue" onclick="loadJob('${j.id}')">Load</button>
        <button class="btn-danger" onclick="deleteJob('${j.id}')">Delete</button>
      </div>
    `;
    wrap.appendChild(div);
  });
}

function deleteJob(id){
  const jobs = getJobs().filter(j=>j.id !== id);
  setJobs(jobs);
  renderJobs();
}

function loadJob(id){
  const jobs = getJobs();
  const found = jobs.find(j=>j.id === id);
  if(!found){ alert('Job not found'); return; }

  const { type, data } = found.payload;

  if(type === 'septic'){
    openSeptic(data.mode || 'conventional');
    document.getElementById('s_customer').value = data.customer || '';
    document.getElementById('s_job').value = data.job || '';
    document.getElementById('s_location').value = data.location || '';
    alert('Loaded job ✅ (Please verify inputs, then Calculate)');
  } else {
    openPad();
    document.getElementById('p_customer').value = data.customer || '';
    document.getElementById('p_job').value = data.job || '';
    document.getElementById('p_location').value = data.location || '';
    alert('Loaded job ✅ (Please verify inputs, then Calculate)');
  }
}

function escapeHtml(str){
  return String(str).replace(/[&<>"']/g, m => ({
    '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'
  }[m]));
}
function cryptoRandomId(){
  if(window.crypto && crypto.getRandomValues){
    const a = new Uint32Array(3);
    crypto.getRandomValues(a);
    return Array.from(a).map(x=>x.toString(16)).join('');
  }
  return 'id_' + Math.random().toString(16).slice(2);
}

goHome();
</script>

</body>
</html>